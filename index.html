<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deep Learning Exam Preparation</title>
    <style>
        /* Same CSS as before */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f7fa;
        }
        h1, h2 {
            color: #2c3e50;
        }
        .container {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .mode-selector {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
        }
        .mode-btn {
            padding: 10px 15px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .mode-btn:hover {
            background-color: #2980b9;
        }
        .mode-btn.active {
            background-color: #2c3e50;
        }
        #question-container {
            margin-bottom: 20px;
        }
        .question {
            font-weight: 600;
            margin-bottom: 15px;
        }
        .options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .option {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .option:hover {
            background-color: #f5f5f5;
        }
        .option.selected {
            background-color: #3498db;
            color: white;
        }
        .option.correct {
            background-color: #2ecc71;
            color: white;
        }
        .option.incorrect {
            background-color: #e74c3c;
            color: white;
        }
        .option-label {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        .nav-btn {
            padding: 10px 15px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .nav-btn:hover {
            background-color: #2980b9;
        }
        .nav-btn:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
        }
        #timer {
            font-size: 1.2em;
            text-align: center;
            margin: 15px 0;
            font-weight: bold;
            color: #2c3e50;
        }
        #timer.warning {
            color: #e67e22;
        }
        #timer.danger {
            color: #e74c3c;
        }
        #results {
            text-align: center;
            margin: 20px 0;
        }
        .result-score {
            font-size: 1.5em;
            font-weight: bold;
            margin: 10px 0;
        }
        .answer-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        .feedback {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
        }
        .feedback.correct {
            background-color: rgba(46, 204, 113, 0.2);
            color: #27ae60;
        }
        .feedback.incorrect {
            background-color: rgba(231, 76, 60, 0.2);
            color: #c0392b;
        }
        .checkbox-option {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .checkbox-option input[type="checkbox"] {
            width: 18px;
            height: 18px;
        }
        /* New styles for progress bar */
        .progress-container {
            width: 100%;
            height: 10px;
            background-color: #f3f3f3;
            border-radius: 5px;
            margin: 15px 0;
        }
        .progress-bar {
            height: 100%;
            background-color: #3498db;
            border-radius: 5px;
            transition: width 0.3s ease;
        }
        /* Mode selection container */
        .initial-screen {
            text-align: center;
            margin: 30px 0;
        }
        .mode-selection {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        .mode-card {
            border: 2px solid #3498db;
            border-radius: 8px;
            padding: 20px;
            width: 200px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .mode-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        }
        .mode-card h3 {
            color: #2c3e50;
            margin-top: 0;
        }
        .mode-card p {
            color: #7f8c8d;
        }
        .check-answers-btn {
            margin-top: 20px;
            padding: 10px 15px;
            background-color: #2ecc71;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .check-answers-btn:hover {
            background-color: #27ae60;
        }
        /* Review question indicator */
        .question-indicator {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        .indicator-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: #e0e0e0;
            cursor: pointer;
        }
        .indicator-dot.active {
            background-color: #3498db;
        }
        .indicator-dot.answered {
            background-color: #f39c12;
        }
        .indicator-dot.correct {
            background-color: #2ecc71;
        }
        .indicator-dot.incorrect {
            background-color: #e74c3c;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Deep Learning Exam Preparation</h1>
        
        <div id="initial-screen" class="initial-screen">
            <h2>Select Quiz Mode</h2>
            <div class="mode-selection">
                <div id="select-practice" class="mode-card">
                    <h3>Practice Mode</h3>
                    <p>Learn at your own pace with immediate feedback</p>
                </div>
                <div id="select-exam" class="mode-card">
                    <h3>Exam Mode</h3>
                    <p>Test your knowledge under timed conditions</p>
                </div>
            </div>
        </div>
        
        <div id="quiz-container" style="display: none;">
            <div class="mode-selector">
                <button id="practice-mode" class="mode-btn">Practice Mode</button>
                <button id="exam-mode" class="mode-btn">Exam Mode</button>
            </div>
            
            <div id="progress-container" class="progress-container">
                <div id="progress-bar" class="progress-bar" style="width: 0%"></div>
            </div>
            
            <div id="timer" style="display: none;"></div>
            
            <div id="question-container">
                <div class="question" id="question-text"></div>
                <div id="options-container"></div>
                <div id="feedback" class="feedback" style="display: none;"></div>
            </div>
            
            <div id="check-answer-container" style="display: none; text-align: center;">
                <button id="check-answer-btn" class="check-answers-btn">Check Answer</button>
            </div>
            
            <div class="navigation">
                <button id="prev-btn" class="nav-btn" disabled>Previous</button>
                <button id="next-btn" class="nav-btn">Next</button>
            </div>
            
            <div id="question-indicator" class="question-indicator"></div>
        </div>
        
        <div id="results" style="display: none;"></div>
    </div>

    <!-- Include the questions database -->
    <script src="questions-database.js"></script>
    
    <script>
        // Quiz state
        const state = {
            mode: '',
            currentQuestionIndex: 0,
            questions: [],
            selectedQuestions: [],
            userAnswers: [],
            examTime: 0,
            timerInterval: null,
            timeRemaining: 0,
            examSubmitted: false,
            quizStarted: false,
            showingResults: false,
            answersChecked: []
        };

        // DOM elements
        const elements = {
            initialScreen: document.getElementById('initial-screen'),
            quizContainer: document.getElementById('quiz-container'),
            practiceBtn: document.getElementById('practice-mode'),
            examBtn: document.getElementById('exam-mode'),
            questionContainer: document.getElementById('question-container'),
            questionText: document.getElementById('question-text'),
            optionsContainer: document.getElementById('options-container'),
            prevBtn: document.getElementById('prev-btn'),
            nextBtn: document.getElementById('next-btn'),
            timer: document.getElementById('timer'),
            results: document.getElementById('results'),
            feedback: document.getElementById('feedback'),
            progressBar: document.getElementById('progress-bar'),
            progressContainer: document.getElementById('progress-container'),
            checkAnswerContainer: document.getElementById('check-answer-container'),
            checkAnswerBtn: document.getElementById('check-answer-btn'),
            questionIndicator: document.getElementById('question-indicator')
        };

        // Setup initial selection screen
        document.getElementById('select-practice').addEventListener('click', () => {
            state.mode = 'practice';
            elements.initialScreen.style.display = 'none';
            elements.quizContainer.style.display = 'block';
            elements.practiceBtn.classList.add('active');
            elements.examBtn.classList.remove('active');
            loadQuestions();
        });

        document.getElementById('select-exam').addEventListener('click', () => {
            state.mode = 'exam';
            elements.initialScreen.style.display = 'none';
            elements.quizContainer.style.display = 'block';
            elements.practiceBtn.classList.remove('active');
            elements.examBtn.classList.add('active');
            loadQuestions();
        });

        // Load questions from JSON file or generate from questions database
        async function loadQuestions() {
            try {
                // First try to load from questions.json
                const response = await fetch('questions.json');
                if (!response.ok) {
                    throw new Error('Failed to load questions');
                }
                state.questions = await response.json();
                initializeQuiz();
            } catch (error) {
                console.log('Generating questions from database...');
                // If questions.json doesn't exist, generate from the database
                generateQuestionsFromDatabase();
            }
        }

        // Generate questions from the questions database
        function generateQuestionsFromDatabase() {
            // Check if questionsDatabase is available
            if (typeof questionsDatabase === 'undefined') {
                console.error('Questions database not found. Using sample questions.');
                state.questions = getSampleQuestions();
                initializeQuiz();
                return;
            }

            let id = 1;
            const allQuestions = [];

            // Process single choice questions
            if (questionsDatabase.singleChoice) {
                questionsDatabase.singleChoice.forEach(q => {
                    allQuestions.push({
                        id: id++,
                        type: "single",
                        question: q.question,
                        options: q.options,
                        answer: q.answer
                    });
                });
            }

            // Process multiple choice questions
            if (questionsDatabase.multipleChoice) {
                questionsDatabase.multipleChoice.forEach(q => {
                    allQuestions.push({
                        id: id++,
                        type: "multiple",
                        question: q.question,
                        options: q.options,
                        answer: q.answer
                    });
                });
            }

            // Process short answer questions
            if (questionsDatabase.shortAnswer) {
                questionsDatabase.shortAnswer.forEach(q => {
                    allQuestions.push({
                        id: id++,
                        type: "short",
                        question: q.question,
                        answer: q.answer
                    });
                });
            }

            state.questions = allQuestions;
            initializeQuiz();
        }

        // Sample questions for initial setup (fallback)
        function getSampleQuestions() {
            return [
                {
                    id: 1,
                    type: "single",
                    question: "What is the capital of France?",
                    options: ["Berlin", "Madrid", "Paris", "Rome"],
                    answer: "Paris"
                },
                {
                    id: 2,
                    type: "multiple",
                    question: "Which of the following are programming languages?",
                    options: ["Python", "Elephant", "Java", "Banana"],
                    answer: ["Python", "Java"]
                },
                {
                    id: 3,
                    type: "short",
                    question: "What does HTML stand for?",
                    answer: "Hypertext Markup Language"
                }
                // Fallback sample questions...
            ];
        }

        // Initialize the quiz
        function initializeQuiz() {
            state.quizStarted = true;
            
            if (state.mode === 'practice') {
                state.selectedQuestions = [...state.questions];
                // In practice mode, don't show the timer
                elements.timer.style.display = 'none';
                // Show check answer button in practice mode
                elements.checkAnswerContainer.style.display = 'block';
            } else {
                // For exam mode, select at least 75% of questions randomly
                const minQuestions = Math.ceil(state.questions.length * 0.75);
                state.selectedQuestions = selectRandomQuestions(minQuestions);
                calculateExamTime();
                startTimer();
                // Hide check answer button in exam mode
                elements.checkAnswerContainer.style.display = 'none';
            }
            
            // Initialize user answers array and answers checked array
            state.userAnswers = new Array(state.selectedQuestions.length).fill(null);
            state.answersChecked = new Array(state.selectedQuestions.length).fill(false);
            
            // Create question indicators
            createQuestionIndicators();
            
            // Update progress bar
            updateProgressBar();
            
            // Display the first question
            renderQuestion();
        }

        // Create indicators for each question
        function createQuestionIndicators() {
            elements.questionIndicator.innerHTML = '';
            
            for (let i = 0; i < state.selectedQuestions.length; i++) {
                const indicator = document.createElement('div');
                indicator.className = 'indicator-dot';
                if (i === state.currentQuestionIndex) {
                    indicator.classList.add('active');
                }
                
                indicator.addEventListener('click', () => {
                    state.currentQuestionIndex = i;
                    renderQuestion();
                    updateQuestionIndicators();
                });
                
                elements.questionIndicator.appendChild(indicator);
            }
        }

        // Update question indicators
        function updateQuestionIndicators() {
            const indicators = elements.questionIndicator.querySelectorAll('.indicator-dot');
            
            indicators.forEach((indicator, index) => {
                indicator.className = 'indicator-dot';
                
                // Mark the current question
                if (index === state.currentQuestionIndex) {
                    indicator.classList.add('active');
                }
                
                // Mark questions that have been answered
                if (state.userAnswers[index]) {
                    indicator.classList.add('answered');
                }
                
                // In practice mode, mark questions that have been checked
                if (state.mode === 'practice' && state.answersChecked[index]) {
                    const isCorrect = checkIfAnswerIsCorrect(index);
                    if (isCorrect) {
                        indicator.classList.add('correct');
                    } else {
                        indicator.classList.add('incorrect');
                    }
                }
                
                // In exam mode after submission, mark correct/incorrect
                if (state.examSubmitted) {
                    const isCorrect = checkIfAnswerIsCorrect(index);
                    if (isCorrect) {
                        indicator.classList.add('correct');
                    } else if (state.userAnswers[index]) {
                        indicator.classList.add('incorrect');
                    }
                }
            });
        }

        // Check if an answer is correct
        function checkIfAnswerIsCorrect(questionIndex) {
            const question = state.selectedQuestions[questionIndex];
            const userAnswer = state.userAnswers[questionIndex];
            
            if (!userAnswer) return false;
            
            if (question.type === 'single') {
                return userAnswer === question.answer;
            } else if (question.type === 'multiple') {
                const allCorrect = question.answer.every(ans => userAnswer.includes(ans));
                const noExtraSelections = userAnswer.every(ans => question.answer.includes(ans));
                return allCorrect && noExtraSelections;
            } else if (question.type === 'short') {
                return userAnswer.trim().toLowerCase() === question.answer.toLowerCase();
            }
            
            return false;
        }

        // Update progress bar
        function updateProgressBar() {
            // Calculate progress as percentage of answered questions
            const answeredCount = state.userAnswers.filter(answer => answer !== null).length;
            const progress = (answeredCount / state.selectedQuestions.length) * 100;
            elements.progressBar.style.width = `${progress}%`;
        }

        // Select random questions for exam mode
        function selectRandomQuestions(minCount) {
            const shuffled = [...state.questions].sort(() => 0.5 - Math.random());
            return shuffled.slice(0, Math.max(minCount, Math.floor(state.questions.length * 0.75)));
        }

        // Calculate exam time based on question types
        function calculateExamTime() {
            let totalMinutes = 0;
            
            state.selectedQuestions.forEach(q => {
                if (q.type === 'single') {
                    totalMinutes += 1.5;
                } else if (q.type === 'multiple') {
                    totalMinutes += 2;
                } else if (q.type === 'short') {
                    totalMinutes += 4.5;
                }
            });
            
            // Convert to seconds
            state.examTime = Math.ceil(totalMinutes * 60);
            state.timeRemaining = state.examTime;
        }

        // Start the timer for exam mode
        function startTimer() {
            elements.timer.style.display = 'block';
            updateTimerDisplay();
            
            state.timerInterval = setInterval(() => {
                state.timeRemaining--;
                updateTimerDisplay();
                
                if (state.timeRemaining <= 0) {
                    clearInterval(state.timerInterval);
                    endExam();
                }
            }, 1000);
        }

        // Update timer display
        function updateTimerDisplay() {
            const minutes = Math.floor(state.timeRemaining / 60);
            const seconds = state.timeRemaining % 60;
            
            elements.timer.textContent = `Time Remaining: ${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            // Add warning colors
            if (state.timeRemaining < 60) {
                elements.timer.className = 'danger';
            } else if (state.timeRemaining < 180) {
                elements.timer.className = 'warning';
            } else {
                elements.timer.className = '';
            }
        }

        // Render the current question
        function renderQuestion() {
            const currentQuestion = state.selectedQuestions[state.currentQuestionIndex];
            elements.questionText.textContent = `${currentQuestion.question}`;
            
            // Clear previous options
            elements.optionsContainer.innerHTML = '';
            elements.feedback.style.display = 'none';
            
            // Render based on question type
            if (currentQuestion.type === 'single') {
                renderSingleChoiceQuestion(currentQuestion);
            } else if (currentQuestion.type === 'multiple') {
                renderMultipleChoiceQuestion(currentQuestion);
            } else if (currentQuestion.type === 'short') {
                renderShortAnswerQuestion(currentQuestion);
            }
            
            // Update navigation buttons
            elements.prevBtn.disabled = state.currentQuestionIndex === 0;
            elements.nextBtn.textContent = state.currentQuestionIndex === state.selectedQuestions.length - 1 ? 'Finish' : 'Next';
            
            // Update question indicators
            updateQuestionIndicators();
            
            // Show feedback if answer has been checked in practice mode
            if (state.mode === 'practice' && state.answersChecked[state.currentQuestionIndex]) {
                showFeedback();
            }
        }

        // Render single choice question
        function renderSingleChoiceQuestion(question) {
            // Shuffle options
            const shuffledOptions = [...question.options].sort(() => 0.5 - Math.random());
            
            shuffledOptions.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option';
                
                // Check if this option was previously selected
                const userAnswer = state.userAnswers[state.currentQuestionIndex];
                if (userAnswer === option) {
                    optionElement.classList.add('selected');
                }
                
                // Show correct/incorrect in practice mode if answer has been checked
                if ((state.mode === 'practice' && state.answersChecked[state.currentQuestionIndex]) || state.examSubmitted) {
                    if (option === question.answer) {
                        optionElement.classList.add('correct');
                    } else if (userAnswer === option) {
                        optionElement.classList.add('incorrect');
                    }
                }
                
                optionElement.innerHTML = `
                    <div class="option-label">
                        <span>${String.fromCharCode(65 + index)}.</span>
                        <span>${option}</span>
                    </div>
                `;
                
                // Add click event only if answer not checked or exam not submitted
                if (!(state.mode === 'practice' && state.answersChecked[state.currentQuestionIndex]) && !state.examSubmitted) {
                    optionElement.addEventListener('click', () => {
                        selectSingleOption(option);
                    });
                }
                
                elements.optionsContainer.appendChild(optionElement);
            });
        }

        // Handle single option selection
        function selectSingleOption(selectedOption) {
            state.userAnswers[state.currentQuestionIndex] = selectedOption;
            
            // Update UI
            const options = elements.optionsContainer.querySelectorAll('.option');
            options.forEach(option => {
                option.classList.remove('selected');
                if (option.textContent.trim().includes(selectedOption)) {
                    option.classList.add('selected');
                }
            });
            
            // Update progress bar
            updateProgressBar();
            
            // Update question indicators
            updateQuestionIndicators();
        }

        // Show feedback for the current question
        function showFeedback() {
            const currentQuestion = state.selectedQuestions[state.currentQuestionIndex];
            const userAnswer = state.userAnswers[state.currentQuestionIndex];
            
            if (!userAnswer) return;
            
            if (currentQuestion.type === 'single') {
                const options = elements.optionsContainer.querySelectorAll('.option');
                options.forEach(option => {
                    const optionText = option.textContent.replace(/[A-Z]\.\s*/g, '').trim();
                    
                    if (optionText === currentQuestion.answer) {
                        option.classList.add('correct');
                    } else if (optionText === userAnswer) {
                        option.classList.add('selected');
                        if (userAnswer !== currentQuestion.answer) {
                            option.classList.add('incorrect');
                        }
                    }
                });
                
                // Show feedback text
                elements.feedback.style.display = 'block';
                if (userAnswer === currentQuestion.answer) {
                    elements.feedback.textContent = 'Correct!';
                    elements.feedback.className = 'feedback correct';
                } else {
                    elements.feedback.textContent = `Incorrect. The correct answer is: ${currentQuestion.answer}`;
                    elements.feedback.className = 'feedback incorrect';
                }
            } else if (currentQuestion.type === 'multiple') {
                showMultipleChoiceFeedback(currentQuestion);
            } else if (currentQuestion.type === 'short') {
                checkShortAnswer(currentQuestion);
            }
        }

        // Render multiple choice question
        function renderMultipleChoiceQuestion(question) {
            // Shuffle options
            const shuffledOptions = [...question.options].sort(() => 0.5 - Math.random());
            
            shuffledOptions.forEach((option) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option checkbox-option';
                
                // Check if this option was previously selected
                const userAnswer = state.userAnswers[state.currentQuestionIndex] || [];
                const isSelected = userAnswer.includes(option);
                
                // Show correct/incorrect if answer has been checked or exam is submitted
                let optionClass = '';
                if ((state.mode === 'practice' && state.answersChecked[state.currentQuestionIndex]) || state.examSubmitted) {
                    if (question.answer.includes(option)) {
                        optionClass = 'correct';
                    } else if (isSelected) {
                        optionClass = 'incorrect';
                    }
                }
                
                optionElement.innerHTML = `
                    <label class="checkbox-option ${optionClass}">
                        <input type="checkbox" value="${option}" ${isSelected ? 'checked' : ''} 
                        ${(state.mode === 'practice' && state.answersChecked[state.currentQuestionIndex]) || state.examSubmitted ? 'disabled' : ''}>
                        <span>${option}</span>
                    </label>
                `;
                
                // Add event listener to checkbox
                const checkbox = optionElement.querySelector('input[type="checkbox"]');
                if (!((state.mode === 'practice' && state.answersChecked[state.currentQuestionIndex]) || state.examSubmitted)) {
                    checkbox.addEventListener('change', () => {
                        updateMultipleSelection();
                    });
                }
                
                elements.optionsContainer.appendChild(optionElement);
            });
            
            // Show feedback if answer has been checked in practice mode
            if ((state.mode === 'practice' && state.answersChecked[state.currentQuestionIndex] && state.userAnswers[state.currentQuestionIndex]) || 
                (state.examSubmitted && state.userAnswers[state.currentQuestionIndex])) {
                showMultipleChoiceFeedback(question);
            }
        }

        // Update multiple choice selections
        function updateMultipleSelection() {
            const checkboxes = elements.optionsContainer.querySelectorAll('input[type="checkbox"]');
            const selectedOptions = [];
            
            checkboxes.forEach(checkbox => {
                if (checkbox.checked) {
                    selectedOptions.push(checkbox.value);
                }
            });
            
            state.userAnswers[state.currentQuestionIndex] = selectedOptions;
            
            // Update progress bar
            updateProgressBar();
            
            // Update question indicators
            updateQuestionIndicators();
        }

        // Show feedback for multiple choice questions
        function showMultipleChoiceFeedback(question) {
            const userSelections = state.userAnswers[state.currentQuestionIndex] || [];
            const correctAnswers = question.answer;
            
            // Check if all selections are correct and no correct options are missed
            const allSelectionsCorrect = userSelections.every(selection => correctAnswers.includes(selection));
            const allCorrectOptionsSelected = correctAnswers.every(answer => userSelections.includes(answer));
            const isFullyCorrect = allSelectionsCorrect && allCorrectOptionsSelected;
            
            // Update UI
            const options = elements.optionsContainer.querySelectorAll('.checkbox-option');
            options.forEach(option => {
                const optionText = option.textContent.trim();
                
                option.classList.remove('correct', 'incorrect');
                if (correctAnswers.includes(optionText)) {
                    option.classList.add('correct');
                } else if (userSelections.includes(optionText)) {
                    option.classList.add('incorrect');
                }
            });
            
            // Show feedback text
            elements.feedback.style.display = 'block';
            if (isFullyCorrect) {
                elements.feedback.textContent = 'Correct!';
                elements.feedback.className = 'feedback correct';
            } else {
                elements.feedback.textContent = `Incorrect. The correct answers are: ${correctAnswers.join(', ')}`;
                elements.feedback.className = 'feedback incorrect';
            }
        }

        // Render short answer question
        function renderShortAnswerQuestion(question) {
            const userAnswer = state.userAnswers[state.currentQuestionIndex] || '';
            
            const inputElement = document.createElement('textarea');
            inputElement.className = 'answer-input';
            inputElement.placeholder = 'Type your answer here...';
            inputElement.value = userAnswer;
            inputElement.rows = 4;
            inputElement.disabled = (state.mode === 'practice' && state.answersChecked[state.currentQuestionIndex]) || state.examSubmitted;
            
            if (!((state.mode === 'practice' && state.answersChecked[state.currentQuestionIndex]) || state.examSubmitted)) {
                inputElement.addEventListener('input', (e) => {
                    state.userAnswers[state.currentQuestionIndex] = e.target.value;
                    // Update progress if user has// Update progress if user has typed something
                    if (e.target.value.trim() !== '') {
                        updateProgressBar();
                        updateQuestionIndicators();
                    }
                });
            }
            
            elements.optionsContainer.appendChild(inputElement);
            
            // Show feedback if answer has been checked in practice mode
            if (state.mode === 'practice' && state.answersChecked[state.currentQuestionIndex] && state.userAnswers[state.currentQuestionIndex]) {
                checkShortAnswer(question);
            }
        }

        // Check short answer
        function checkShortAnswer(question) {
            const userAnswer = state.userAnswers[state.currentQuestionIndex];
            const correctAnswer = question.answer;
            
            const isCorrect = userAnswer.trim().toLowerCase() === correctAnswer.toLowerCase();
            
            // Show feedback
            elements.feedback.style.display = 'block';
            if (isCorrect) {
                elements.feedback.textContent = 'Correct!';
                elements.feedback.className = 'feedback correct';
            } else {
                elements.feedback.textContent = `Incorrect. The correct answer is: ${correctAnswer}`;
                elements.feedback.className = 'feedback incorrect';
            }
        }

        // Handle check answer button click
        elements.checkAnswerBtn.addEventListener('click', () => {
            if (state.userAnswers[state.currentQuestionIndex]) {
                state.answersChecked[state.currentQuestionIndex] = true;
                showFeedback();
                updateQuestionIndicators();
            } else {
                alert('Please provide an answer before checking.');
            }
        });

        // Navigate to previous question
        elements.prevBtn.addEventListener('click', () => {
            if (state.currentQuestionIndex > 0) {
                state.currentQuestionIndex--;
                renderQuestion();
            }
        });

        // Navigate to next question or finish
        elements.nextBtn.addEventListener('click', () => {
            if (state.currentQuestionIndex < state.selectedQuestions.length - 1) {
                state.currentQuestionIndex++;
                renderQuestion();
            } else {
                // If on last question and in exam mode, finish the quiz
                if (state.mode === 'exam' && !state.examSubmitted) {
                    confirmEndExam();
                } else if (state.mode === 'practice') {
                    // In practice mode, show summary
                    showResults();
                }
            }
        });

        // Ask for confirmation before ending exam
        function confirmEndExam() {
            const unansweredCount = state.userAnswers.filter(answer => answer === null).length;
            
            if (unansweredCount > 0) {
                if (confirm(`You have ${unansweredCount} unanswered questions. Are you sure you want to finish the exam?`)) {
                    endExam();
                }
            } else {
                endExam();
            }
        }

        // End the exam and show results
        function endExam() {
            state.examSubmitted = true;
            clearInterval(state.timerInterval);
            showResults();
        }

        // Show quiz results
        function showResults() {
            state.showingResults = true;
            
            // Calculate score
            let correctCount = 0;
            let totalAnswered = 0;
            
            state.selectedQuestions.forEach((question, index) => {
                const userAnswer = state.userAnswers[index];
                if (userAnswer) {
                    totalAnswered++;
                    if (checkIfAnswerIsCorrect(index)) {
                        correctCount++;
                    }
                }
            });
            
            const percentage = totalAnswered > 0 ? Math.round((correctCount / state.selectedQuestions.length) * 100) : 0;
            
            // Show results
            elements.quizContainer.style.display = 'none';
            elements.results.style.display = 'block';
            
            // Build results HTML
            let resultsHTML = `
                <h2>Quiz Results</h2>
                <div class="result-score">Score: ${correctCount}/${state.selectedQuestions.length} (${percentage}%)</div>
                <p>You answered ${totalAnswered} out of ${state.selectedQuestions.length} questions.</p>
            `;
            
            // Add a different message based on the score
            if (percentage >= 80) {
                resultsHTML += '<p>Excellent work! You\'ve mastered this material.</p>';
            } else if (percentage >= 60) {
                resultsHTML += '<p>Good job! You understand most of the material.</p>';
            } else {
                resultsHTML += '<p>Keep practicing! You\'ll improve with more study.</p>';
            }
            
            // Add a button to review answers
            resultsHTML += `
                <button id="review-answers" class="nav-btn">Review Answers</button>
                <button id="restart-quiz" class="nav-btn">Start New Quiz</button>
            `;
            
            elements.results.innerHTML = resultsHTML;
            
            // Add event listeners to new buttons
            document.getElementById('review-answers').addEventListener('click', reviewAnswers);
            document.getElementById('restart-quiz').addEventListener('click', restartQuiz);
        }

        // Review quiz answers
        function reviewAnswers() {
            state.showingResults = false;
            elements.results.style.display = 'none';
            elements.quizContainer.style.display = 'block';
            state.currentQuestionIndex = 0;
            renderQuestion();
        }

        // Restart the quiz
        function restartQuiz() {
            // Reset state
            state.currentQuestionIndex = 0;
            state.userAnswers = [];
            state.answersChecked = [];
            state.examSubmitted = false;
            state.showingResults = false;
            
            // Clear timer if it's still running
            if (state.timerInterval) {
                clearInterval(state.timerInterval);
                state.timerInterval = null;
            }
            
            // Show initial screen
            elements.results.style.display = 'none';
            elements.quizContainer.style.display = 'none';
            elements.initialScreen.style.display = 'block';
        }

        // Mode switching
        elements.practiceBtn.addEventListener('click', () => {
            if (state.mode !== 'practice' && !state.showingResults) {
                if (confirm('Changing modes will reset your progress. Are you sure?')) {
                    state.mode = 'practice';
                    elements.practiceBtn.classList.add('active');
                    elements.examBtn.classList.remove('active');
                    
                    // Clear timer if it's running
                    if (state.timerInterval) {
                        clearInterval(state.timerInterval);
                        state.timerInterval = null;
                    }
                    
                    // Reset and initialize quiz for practice mode
                    elements.timer.style.display = 'none';
                    elements.checkAnswerContainer.style.display = 'block';
                    initializeQuiz();
                }
            }
        });

        elements.examBtn.addEventListener('click', () => {
            if (state.mode !== 'exam' && !state.showingResults) {
                if (confirm('Changing modes will reset your progress. Are you sure?')) {
                    state.mode = 'exam';
                    elements.practiceBtn.classList.remove('active');
                    elements.examBtn.classList.add('active');
                    
                    // Hide check answer button for exam mode
                    elements.checkAnswerContainer.style.display = 'none';
                    
                    // Reset and initialize quiz for exam mode
                    initializeQuiz();
                }
            }
        });

        // Add keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (!state.quizStarted || state.showingResults) return;
            
            if (e.key === 'ArrowLeft' && !elements.prevBtn.disabled) {
                elements.prevBtn.click();
            } else if (e.key === 'ArrowRight' && state.currentQuestionIndex < state.selectedQuestions.length - 1) {
                elements.nextBtn.click();
            } else if (e.key === 'Enter' && state.mode === 'practice') {
                // Check answer on Enter key in practice mode
                elements.checkAnswerBtn.click();
            }
        });

        // Initialize by showing initial screen
        // This is already set up in the HTML
    </script>
</body>
</html>